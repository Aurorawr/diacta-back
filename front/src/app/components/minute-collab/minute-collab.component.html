<div>
    <h2 *ngIf="lastChangesDate">Últimos cambios realizados a las {{lastChangesDate.toLocaleString()}}</h2>
    <mat-card class="minute-collab-card">
        <mat-card-title>
            <h1 class='inline-block title'><strong>Acta en desarrollo</strong></h1>
        </mat-card-title>
        <mat-card-content>
            <div *ngIf="minute" class='padding-2r'>
                <div *ngIf='minute.header'>
                    <div>
                        <h2 class='inline-block'>Encabezado</h2>
                        <button class='edit-button' mat-icon-button color="primary" (click)='switchEdit("header")' [disabled]='externalEditions.header.editing'>
                            <mat-icon *ngIf='!localEditions.header'>edit</mat-icon>
                            <mat-icon *ngIf='localEditions.header'>edit_off</mat-icon>
                        </button>
                        <h3 *ngIf='externalEditions.header.editing' class='inline-block'>El usuario {{externalEditions.header.editorName}} está editando este campo...</h3>
                    </div>
                    <p *ngIf='!localEditions.header' class='minute-text'>{{ minute.header }}</p>
                    <div *ngIf='localEditions.header' class='align-right'>
                        <mat-form-field appearance="standard" class='full-width'>
                            <textarea #headerInput matInput cdkTextareaAutosize [(ngModel)]='minute.header' (keyup)='editBasicData("header", $event)'></textarea>
                        </mat-form-field>
                        <button mat-icon-button color="primary" (click)='switchEdit("header")'>
                            <mat-icon>edit_off</mat-icon>
                        </button>
                    </div>
                </div>
                <h3 class="info-text">{{getMinuteDatePlaceData}}</h3>
                <div *ngIf='minute.description'>
                    <div>
                        <h2 class='inline-block'>Descripción</h2>
                        <button class='edit-button' mat-icon-button color="primary" (click)='switchEdit("description")' [disabled]='externalEditions.description.editing'>
                            <mat-icon *ngIf='!localEditions.description'>edit</mat-icon>
                            <mat-icon *ngIf='localEditions.description'>edit_off</mat-icon>
                        </button>
                        <h3 *ngIf='externalEditions.description.editing' class='inline-block'>El usuario {{externalEditions.description.editorName}} está editando este campo...</h3>
                    </div>
                    <p *ngIf='!localEditions.description' class='minute-text'>{{ minute.description }}</p>
                    <div *ngIf='localEditions.description' class='align-right'>
                        <mat-form-field appearance="standard" class='full-width'>
                            <textarea #headerInput matInput cdkTextareaAutosize [(ngModel)]='minute.description' (keyup)='editBasicData("description", $event)'></textarea>
                        </mat-form-field>
                        <button mat-icon-button color="primary" (click)='switchEdit("description")'>
                            <mat-icon>edit_off</mat-icon>
                        </button>
                    </div>
                </div>
                <h1>Asistentes</h1>
                <mat-list>
                    <mat-list-item *ngFor="let participant of minute.participants">{{participant.user.name}} ({{participant.user.email}})</mat-list-item>
                </mat-list>
                <h1>Compromisos previos</h1>
                <p *ngIf='!minute.previousCompromises.length' class='minute-text'>No hay compromisos previos</p>
                <div *ngIf='minute.previousCompromises.length'>
                    <button mat-icon-button class="float-r" color="primary" (click)='switchEdit("description")'>
                        <mat-icon>edit</mat-icon>
                    </button>
                    <h4 *ngFor="let compromise of minute.previousCompromises; let i = index">{{i+1}}. {{compromise.content}}</h4>
                </div>
                <div>
                    <div>
                        <h1 class='inline-block'>Tabla de la reunión</h1>
                        <button class='edit-button' mat-icon-button color="primary" (click)='addEdit("addingTopic")'>
                            <mat-icon *ngIf='!localEditions.addingTopic'>add_circle_outline</mat-icon>
                        </button>
                    </div>
                    <mat-list>
                        <mat-list-item *ngFor="let topic of minute.topics">{{topic.enum}}. {{topic.name}}</mat-list-item>
                    </mat-list>
                    <h3 *ngFor='let edition of externalEditions.addingTopic' class='inline-block'>El usuario {{edition.editorName}} está agregando un nuevo tema...</h3>
                    <div *ngIf='localEditions.addingTopic' class='align-right'>
                        <mat-form-field appearance="standard" class="full-width">
                            <mat-label>Nombre del tema</mat-label>
                            <input matInput [(ngModel)]='newTopic.name' />
                        </mat-form-field>
                        <mat-form-field appearance="standard" class="full-width">
                            <mat-label>Descripción (opcional)</mat-label>
                            <textarea matInput cdkTextareaAutosize [(ngModel)]='newTopic.description' rows="2"></textarea>
                        </mat-form-field>
                        <button mat-icon-button color="primary" (click)='removeEdit("addingTopic", true)'>
                            <mat-icon>cancel</mat-icon>
                        </button>
                        <button mat-icon-button color="primary" (click)='removeEdit("addingTopic")'>
                            <mat-icon>save</mat-icon>
                        </button>
                    </div>
                </div>
                <h1>Desarrollo</h1>
                <div *ngFor="let topic of minute.topics">
                    <h2>{{topic.enum}}. {{topic.name}}</h2>
                    <button *ngIf='!localEditions.addingDialogueElements' mat-raised-button color="primary" (click)='addEdit("addingDialogueElements", topic._id)'>
                        Agregar elemento del diálogo
                    </button>
                    <div *ngIf='localEditions.addingDialogueElements' class='align-right'>
                        <div fxLayout='col'>
                            <div fxFlex='33'>
                                <mat-form-field appearance="standard" class="full-width">
                                    <mat-label>Tipo</mat-label>
                                    <mat-select [(value)]='newDialogueElement.elementType'>
                                      <mat-option *ngFor="let type of dialogueElementTypes" [value]="type">
                                        {{type}}
                                      </mat-option>
                                    </mat-select>
                                  </mat-form-field>
                            </div>
                            <div fxFlex>
                                <mat-form-field appearance="standard" class="full-width">
                                    <mat-label>Contenido</mat-label>
                                    <textarea matInput cdkTextareaAutosize [(ngModel)]='newDialogueElement.content' rows="2"></textarea>
                                </mat-form-field>
                            </div>
                        </div>
                        <button mat-icon-button color="primary" (click)='removeEdit("addingDialogueElements", true)'>
                            <mat-icon>cancel</mat-icon>
                        </button>
                        <button mat-icon-button color="primary" (click)='removeEdit("addingDialogueElements", false, topic._id)'>
                            <mat-icon>save</mat-icon>
                        </button>
                    </div>
                    <p *ngIf='topic.description' class='minute-text'>{{topic.description}}</p>
                    <p *ngFor='let note of topic.notes' class='minute-text'>{{note.content}}</p>
                    <p *ngFor='let diaEl of topic.dialogueElements' class='minute-text'><strong>{{diaEl.elementType}} {{minute.enum}}.{{diaEl.enum}}:</strong> {{diaEl.content}}</p>
                    <div *ngFor='let edition of externalEditions.addingDialogueElements'>
                        <h3 *ngIf="edition.topicId == topic._id" class='inline-block'>El usuario {{edition.editorName}} está agregando un nuevo elemento del diálogo...</h3>
                    </div>
                </div>
                <h1>Adjuntos</h1>
                <mat-list>
                    <mat-list-item *ngFor='let annex of minute.annexes' class="full-width">
                        <mat-icon matListIcon>assignment</mat-icon>
                        <p matLine>{{ annex.name }}</p>
                        <p matLine><a href="{{annex.url}}" target="_blank" rel="noopener">Link</a></p>
                        <button mat-icon-button>
                            <mat-icon>close</mat-icon>
                        </button>
                    </mat-list-item>
                </mat-list>
                <h3 *ngIf="minute.endTime" class="info-text"><strong>Hora de término:</strong> {{minute.endTime}}</h3>
            </div>
        </mat-card-content>
    </mat-card>
</div>